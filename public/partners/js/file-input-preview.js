/*
 * FilePondPluginImagePreview 2.0.1
 * Licensed under MIT, https://opensource.org/licenses/MIT
 * Please visit https://pqina.nl/filepond for details.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.FilePondPluginImagePreview=t()}(this,function(){"use strict";var e=function(e){return/^image/.test(e.type)},t=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var c={key:e,arg:t,resolve:n,reject:i,next:null};o?o=o.next=c:(a=o=c,r(e,t))})}function r(n,a){try{var o=t[n](a),c=o.value;c instanceof e?Promise.resolve(c.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(o.done?"return":"normal",o.value)}catch(s){i("throw",s)}}function i(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}a=a.next,a?r(a.key,a.arg):o=null}var a,o;this._invoke=n,"function"!=typeof t["return"]&&(this["return"]=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype["throw"]=function(e){return this._invoke("throw",e)},t.prototype["return"]=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}),n={1:function(){return[1,0,0,1,0,0]},2:function(e){return[-1,0,0,1,e,0]},3:function(e,t){return[-1,0,0,-1,e,t]},4:function(e,t){return[1,0,0,-1,0,t]},5:function(){return[0,1,1,0,0,0]},6:function(e,t){return[0,1,-1,0,t,0]},7:function(e,t){return[0,-1,-1,0,t,e]},8:function(e){return[0,-1,1,0,0,e]}},r=function(e,r,i,a){a!==-1&&e.transform.apply(e,t(n[a](r,i)))},i=function(e,t,n,i){if(t=Math.round(t),n=Math.round(n),i>=5&&i<=8){var a=[n,t];t=a[0],n=a[1]}var o=document.createElement("canvas"),c=o.getContext("2d");return i>=5&&i<=8?(o.width=n,o.height=t):(o.width=t,o.height=n),c.save(),r(c,t,n,i),c.drawImage(e,0,0,t,n),c.restore(),"close"in e&&e.close(),o},a=function(e){return/^image/.test(e.type)&&!/svg/.test(e.type)},o={type:"spring",stiffness:.5,damping:.45,mass:10},c=function(e){return e.utils.createView({name:"image-preview",tag:"div",ignoreRect:!0,create:function(e){var t=e.root;t.ref.clip=document.createElement("div"),t.element.appendChild(t.ref.clip);var n=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR");null!==n&&("grid"===n?t.element.dataset.transparencyIndicator=n:t.element.dataset.transparencyIndicator="color")},write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:function(e){var t=e.root,n=e.props,r=e.action,o=n.id,c=t.query("GET_ITEM",{id:n.id}),s=t.query("GET_IMAGE_PREVIEW_TRANSPARENCY_INDICATOR"),u=c.getMetadata("exif")||{},d=u.orientation||-1,f=r.data,l=f.width,p=f.height;if(d>=5&&d<=8){var E=[p,l];l=E[0],p=E[1]}var h=c.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:p/l},v=window.devicePixelRatio,I=t.query("GET_IMAGE_PREVIEW_HEIGHT"),_=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),y=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT"),g=t.rect.inner.width,m=p/l,w=g,R=g*m,M=null!==I?I:Math.max(_,Math.min(p,y)),T=M/m,A=a(c.file)?i(r.data,T*v,M*v,d):r.data,G=null!==I?I:Math.max(_,Math.min(g*h.aspectRatio,y)),D=G/h.aspectRatio;D>w&&(D=w,G=D*h.aspectRatio);var P=G/(R*h.rect.height);l=w*P,p=R*P;var x=-h.rect.x*w*P,V=-h.rect.y*R*P;t.ref.clip.style.cssText="\n                    width: "+Math.round(D)+"px;\n                    height: "+Math.round(G)+"px;\n                ",A.style.cssText="\n                    "+(null!==s&&"grid"!==s?"background-color: "+s+";":"")+"\n                    width: "+Math.round(l)+"px;\n                    height: "+Math.round(p)+"px;\n                    transform: translate("+Math.round(x)+"px, "+Math.round(V)+"px) rotateZ(0.00001deg);\n                ",t.ref.clip.appendChild(A),t.dispatch("DID_IMAGE_PREVIEW_DRAW",{id:o})}}),mixins:{styles:["scaleX","scaleY","opacity"],animations:{scaleX:o,scaleY:o,opacity:{type:"tween",duration:750}}}})},s="<radialGradient id=\"filepond--image-preview-radial-gradient\" cx=\".5\" cy=\"1.25\" r=\"1.15\">\n<stop offset='50%' stop-color='#000000'/>\n<stop offset='56%' stop-color='#0a0a0a'/>\n<stop offset='63%' stop-color='#262626'/>\n<stop offset='69%' stop-color='#4f4f4f'/>\n<stop offset='75%' stop-color='#808080'/>\n<stop offset='81%' stop-color='#b1b1b1'/>\n<stop offset='88%' stop-color='#dadada'/>\n<stop offset='94%' stop-color='#f6f6f6'/>\n<stop offset='100%' stop-color='#ffffff'/>\n</radialGradient>\n\n<mask id=\"filepond--image-preview-masking\">\n<rect x=\"0\" y=\"0\" width=\"500\" height=\"200\" fill=\"url(#filepond--image-preview-radial-gradient)\"></rect>\n</mask>",u=function(){if("interactive"===document.readyState){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.style.cssText="position:absolute;width:0;height:0",e.innerHTML=s,document.body.appendChild(e)}},d="undefined"!=typeof navigator;d&&(u(),document.addEventListener("readystatechange",u));var f=!!d&&(document.documentMode||/Edge/.test(navigator.userAgent)),l=function(e){return e.utils.createView({name:"image-preview-overlay",tag:"div",ignoreRect:!0,create:function(e){var t=e.root,n=e.props;t.element.classList.add("filepond--image-preview-overlay-"+n.status),t.element.innerHTML='<svg width="500" height="200" viewBox="0 0 500 200" preserveAspectRatio="none">\n                '+(f?"<defs>"+s+"</defs>":"")+'\n                <rect x="0" width="500" height="200" fill="currentColor" mask="url(#filepond--image-preview-masking)"></rect>\n            </svg>\n            '},mixins:{styles:["opacity"],animations:{opacity:{type:"spring",mass:25}}}})},p=function(){self.onmessage=function(t){e(t.data.message,function(e){self.postMessage({id:t.data.id,message:e},[e])})};var e=function(e,t){fetch(e.file).then(function(e){return e.blob()}).then(function(e){return createImageBitmap(e)}).then(function(e){return t(e)})}},E=function(e,t){var n=new Image;n.onload=function(){var e=n.naturalWidth,r=n.naturalHeight;n=null,t(e,r)},n.src=e},h=function(e){return"createImageBitmap"in window&&a(e)},v=function(e){var t=l(e),n=function(t){var n=t.root,r=t.props,i=e.utils,a=i.createWorker,o=i.loadImage,c=r.id,s=n.query("GET_ITEM",c),u=URL.createObjectURL(s.file),d=function(e,t,n,r){o(u).then(f)},f=function(e){URL.revokeObjectURL(u),n.dispatch("DID_IMAGE_PREVIEW_LOAD",{id:c,data:e})};E(u,function(e,t){if(n.dispatch("DID_IMAGE_PREVIEW_CALCULATE_SIZE",{id:c,width:e,height:t}),h(s.file)){var r=a(p);r.post({file:u},function(e){return r.terminate(),e?void f(e):void d(s)})}else d(s)})},r=function(e){var t=e.root;t.ref.overlayShadow.opacity=1},i=function(e){var t=e.root,n=t.ref.image;n.scaleX=1,n.scaleY=1,n.opacity=1},a=function(e){var t=e.root;t.ref.overlayShadow.opacity=1,t.ref.overlayError.opacity=0,t.ref.overlaySuccess.opacity=0},o=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlayError.opacity=1},s=function(e){var t=e.root;t.ref.overlayShadow.opacity=.25,t.ref.overlaySuccess.opacity=1},u=function(n){var r=n.root,i=n.props,a=c(e);r.ref.image=r.appendChildView(r.createChildView(a,{id:i.id,scaleX:1.25,scaleY:1.25,opacity:0})),r.ref.overlayShadow=r.appendChildView(r.createChildView(t,{opacity:0,status:"idle"})),r.ref.overlaySuccess=r.appendChildView(r.createChildView(t,{opacity:0,status:"success"})),r.ref.overlayError=r.appendChildView(r.createChildView(t,{opacity:0,status:"failure"}))};return e.utils.createView({name:"image-preview-wrapper",create:u,write:e.utils.createRoute({DID_IMAGE_PREVIEW_LOAD:r,DID_IMAGE_PREVIEW_DRAW:i,DID_IMAGE_PREVIEW_CONTAINER_CREATE:n,DID_THROW_ITEM_LOAD_ERROR:o,DID_THROW_ITEM_PROCESSING_ERROR:o,DID_THROW_ITEM_INVALID:o,DID_COMPLETE_ITEM_PROCESSING:s,DID_START_ITEM_PROCESSING:a,DID_REVERT_ITEM_PROCESSING:a})})},I=function(t){var n=t.addFilter,r=t.utils,i=r.Type,o=r.createRoute,c=r.isFile,s=v(t);return n("CREATE_VIEW",function(t){var n=t.is,r=t.view,i=t.query;if(n("file")&&i("GET_ALLOW_IMAGE_PREVIEW")){var u=function(t){var n=t.root,a=t.props,o=a.id,u=i("GET_ITEM",o);if(u&&c(u.file)){var d=u.file;if(e(d)){var f="createImageBitmap"in(window||{}),l=i("GET_IMAGE_PREVIEW_MAX_FILE_SIZE");!f&&l&&d.size>l||(n.ref.imagePreview=r.appendChildView(r.createChildView(s,{id:o})),n.dispatch("DID_IMAGE_PREVIEW_CONTAINER_CREATE",{id:o}))}}},d=function(e){var t=e.root,n=e.props,r=e.action,i=t.query("GET_ITEM",{id:n.id}),o=i.getMetadata("exif")||{},c=o.orientation||-1,s=r.width,u=r.height;if(c>=5&&c<=8){var d=[u,s];s=d[0],u=d[1]}var f=i.getMetadata("crop")||{rect:{x:0,y:0,width:1,height:1},aspectRatio:u/s},l=t.query("GET_IMAGE_PREVIEW_HEIGHT"),p=t.query("GET_IMAGE_PREVIEW_MIN_HEIGHT"),E=t.query("GET_IMAGE_PREVIEW_MAX_HEIGHT");if(!a(i.file)){var h=2048/s;s*=h,u*=h}u=null!==l?l:Math.max(p,Math.min(u,E)),s=u/f.aspectRatio,s>t.rect.element.width&&(s=t.rect.element.width,u=s*f.aspectRatio),t.ref.imagePreview.element.style.cssText="height:"+Math.round(u)+"px"};r.registerWriter(o({DID_LOAD_ITEM:u,DID_IMAGE_PREVIEW_CALCULATE_SIZE:d}))}}),{options:{allowImagePreview:[!0,i.BOOLEAN],imagePreviewHeight:[null,i.INT],imagePreviewMinHeight:[44,i.INT],imagePreviewMaxHeight:[256,i.INT],imagePreviewMaxFileSize:[null,i.INT],imagePreviewTransparencyIndicator:[null,i.STRING]}}};return"undefined"!=typeof navigator&&document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:I})),I});